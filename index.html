<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gold Trading Dashboard</title>

<style>

body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  background:white;
  color:black;
}

h1{
  text-align:center;
}

/* GRID */

.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  margin-top:20px;
}

/* BOX */

.box{
  border:1px solid black;
  padding:15px;
  border-radius:6px;
  min-height:180px;
}

.highlight{
  border:3px solid gold;
  background:#fffbe6;
}

.timer{
  float:right;
  font-size:12px;
  color:#555;
}

ul{
  padding-left:18px;
}

li{
  font-size:14px;
  margin-bottom:6px;
}

</style>
</head>


<body>

<h1>Gold Trading Live Dashboard</h1>

<div class="grid">

<!-- GOLD -->
<div class="box">
<h3>Gold Price <span id="timer" class="timer"></span></h3>
<h2 id="gold">Loading...</h2>
</div>

<!-- GOLD IMPACT -->
<div class="box highlight">
<h3>ðŸ”¥ Gold Impact News</h3>
<ul id="impact">Loading...</ul>
</div>

<!-- MARKET NEWS -->
<div class="box">
<h3>Market News</h3>
<ul id="news">Loading...</ul>
</div>

<!-- STATUS -->
<div class="box">
<h3>System Status</h3>
<p id="status">Running</p>
<p>Optimized Refresh</p>
</div>

</div>



<script>

const BASE = "https://gold-proxy.abhi-koiri.workers.dev";

let time = 60;


/* ================= GOLD ================= */

async function loadGold(){

 try{

  const r = await fetch(BASE+"/gold");
  const d = await r.json();

  const p =
   d.chart.result[0].meta.regularMarketPrice;

  document.getElementById("gold").innerText =
   "$ " + p;

 }catch{

  document.getElementById("gold").innerText =
   "Unavailable";
 }
}


/* ================= TIMER ================= */

setInterval(()=>{

 time--;

 if(time<=0){
  time=60;
  loadGold();
 }

 document.getElementById("timer").innerText =
  time+"s";

},1000);

loadGold();



/* ================= NEWS ================= */

async function loadNews(){

 try{

  const r = await fetch(
   BASE + "/news?q=gold economy inflation fed dollar rates"
  );

  if(!r.ok) throw "API Error";

  const d = await r.json();

  if(!d.articles || d.articles.length===0)
   throw "No News";

  let impact="", normal="";

  d.articles.slice(0,12).forEach(n=>{

   const t = n.title.toLowerCase();

   const li = `
    <li>
     <a href="${n.url}" target="_blank">
      ${n.title}
     </a>
    </li>`;

   if(
    t.includes("gold") ||
    t.includes("fed") ||
    t.includes("inflation") ||
    t.includes("rate") ||
    t.includes("dollar")
   ){
    impact += li;
   }else{
    normal += li;
   }

  });

  document.getElementById("impact").innerHTML =
   impact || "<li>No strong signals</li>";

  document.getElementById("news").innerHTML =
   normal || "<li>No updates</li>";

  document.getElementById("status").innerText =
   "Running";

 }catch(e){

  document.getElementById("impact").innerHTML =
   "<li>News temporarily unavailable</li>";

  document.getElementById("news").innerHTML =
   "<li>Please try later</li>";

  document.getElementById("status").innerText =
   "News API issue";
 }
}

loadNews();
setInterval(loadNews,600000); // 10 min



</script>

</body>
</html>
