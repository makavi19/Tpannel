<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gold Trading Dashboard</title>

<style>

body{
  margin:0;
  padding:20px;
  font-family:Arial, sans-serif;
  background:#fff;
  color:#000;
}

h1{
  text-align:center;
  margin-bottom:20px;
}

/* GRID */

.dashboard{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
}

/* BOX */

.box{
  border:1px solid #000;
  padding:12px;
  border-radius:6px;
  min-height:200px;
  background:#fff;
}

.box h3{
  margin-top:0;
  border-bottom:1px solid #000;
  padding-bottom:5px;
}

/* GOLD IMPACT BOX */

.impact{
  border:3px solid gold;
  background:#fffbe6;
}

/* TIMER */

.timer{
  float:right;
  font-size:12px;
  color:#555;
}

/* LIST */

ul{
  padding-left:18px;
}

li{
  font-size:13px;
  margin-bottom:6px;
}

a{
  color:black;
  text-decoration:none;
}

a:hover{
  text-decoration:underline;
}

</style>
</head>


<body>

<h1>Gold Trading Live Dashboard</h1>

<div class="dashboard">

<!-- 1 ECONOMY -->
<div class="box">
<h3>Economic News</h3>
<ul id="eco"></ul>
</div>

<!-- 2 CENTRAL BANK -->
<div class="box">
<h3>Central Banks</h3>
<ul id="cb"></ul>
</div>

<!-- 3 USD -->
<div class="box">
<h3>US Dollar</h3>
<ul id="usd"></ul>
</div>

<!-- 4 GEOPOLITICS -->
<div class="box">
<h3>Geopolitics</h3>
<ul id="geo"></ul>
</div>

<!-- 5 SENTIMENT -->
<div class="box">
<h3>Market Sentiment</h3>
<ul id="sentiment"></ul>
</div>

<!-- 6 COMMODITIES -->
<div class="box">
<h3>Commodities</h3>
<ul id="com"></ul>
</div>

<!-- 7 GOLD -->
<div class="box">
<h3>Gold Price <span id="goldTimer" class="timer"></span></h3>
<h2 id="goldPrice">Loading...</h2>
</div>

<!-- 8 CALENDAR -->
<div class="box">
<h3>Economic Calendar</h3>
<ul id="calendar"></ul>
</div>

<!-- 9 GOLD IMPACT -->
<div class="box impact">
<h3>ðŸ”¥ Gold Impact News</h3>
<ul id="impact"></ul>
</div>

</div>


<script>

const BASE = "https://gold-proxy.abhi-koiri.workers.dev";

let goldTime = 60;


/* ================= GOLD ================= */

async function loadGold(){

 try{

  const r = await fetch(BASE+"/gold");
  const d = await r.json();

  const p =
   d.chart.result[0].meta.regularMarketPrice;

  document.getElementById("goldPrice").innerText =
   "$ " + p;

 }catch{

  document.getElementById("goldPrice").innerText =
   "Unavailable";
 }
}


setInterval(()=>{

 goldTime--;

 if(goldTime<=0){
  goldTime=60;
  loadGold();
 }

 document.getElementById("goldTimer").innerText =
  goldTime+"s";

},1000);

loadGold();


/* ================= NEWS ================= */

async function loadNews(){

 try{

  const r = await fetch(
   BASE+"/news?q=gold economy fed inflation dollar war oil rates market"
  );

  const d = await r.json();

  let eco="",cb="",usd="",geo="",sen="",com="",imp="";


  d.articles.slice(0,25).forEach(n=>{

   const t = n.title.toLowerCase();

   const li = `
   <li>
    <a href="${n.url}" target="_blank">
     ${n.title}
    </a>
   </li>`;


   // ECONOMY
   if(t.includes("economy")||t.includes("gdp")||t.includes("recession"))
    eco+=li;

   // CENTRAL BANK
   if(t.includes("fed")||t.includes("central")||t.includes("rate"))
    cb+=li;

   // USD
   if(t.includes("dollar")||t.includes("usd")||t.includes("currency"))
    usd+=li;

   // GEOPOLITICS
   if(t.includes("war")||t.includes("china")||t.includes("russia"))
    geo+=li;

   // SENTIMENT
   if(t.includes("market")||t.includes("stocks")||t.includes("selloff"))
    sen+=li;

   // COMMODITIES
   if(t.includes("oil")||t.includes("silver")||t.includes("commodity"))
    com+=li;

   // GOLD IMPACT
   if(
    t.includes("gold")||
    t.includes("fed")||
    t.includes("inflation")||
    t.includes("rate")||
    t.includes("dollar")||
    t.includes("crisis")
   )
    imp+=li;

  });


  // Fallbacks

  eco = eco || "<li>No major economic news</li>";
  cb  = cb  || "<li>No central bank updates</li>";
  usd = usd || "<li>No USD movement news</li>";
  geo = geo || "<li>No geopolitical tension</li>";
  sen = sen || "<li>Market neutral</li>";
  com = com || "<li>No commodity updates</li>";
  imp = imp || "<li>No strong gold signals</li>";


  document.getElementById("eco").innerHTML = eco;
  document.getElementById("cb").innerHTML = cb;
  document.getElementById("usd").innerHTML = usd;
  document.getElementById("geo").innerHTML = geo;
  document.getElementById("sentiment").innerHTML = sen;
  document.getElementById("com").innerHTML = com;
  document.getElementById("impact").innerHTML = imp;


 }catch{

  document
   .querySelectorAll("ul")
   .forEach(u=>u.innerHTML="<li>Unavailable</li>");
 }
}


loadNews();
setInterval(loadNews,600000); // 10 min


/* ================= CALENDAR (PLACEHOLDER) ================= */

function loadCalendar(){

 document.getElementById("calendar").innerHTML =
  "<li>Calendar API pending</li>";
}

loadCalendar();

</script>

</body>
</html>
