<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gold Trading Dashboard</title>

<style>

body{
  font-family: Arial, sans-serif;
  background:white;
  color:black;
  margin:0;
  padding:20px;
}

h1{
  text-align:center;
}

.grid{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:20px;
  margin-top:20px;
}

.box{
  border:1px solid #000;
  padding:15px;
  min-height:200px;
}

.box h2{
  margin-top:0;
  font-size:18px;
  border-bottom:1px solid #000;
  padding-bottom:5px;
}

.timer{
  float:right;
  font-size:12px;
  color:gray;
}

</style>
</head>


<body>

<h1>Gold Trading Live Dashboard</h1>


<div class="grid">

  <!-- GOLD -->
  <div class="box">
    <h2>Gold Price <span id="goldTimer" class="timer"></span></h2>
    <div id="goldPrice">Loading...</div>
  </div>


  <!-- NEWS -->
  <div class="box">
    <h2>Gold News <span id="newsTimer" class="timer"></span></h2>
    <div id="newsBox">Loading...</div>
  </div>


  <!-- CALENDAR -->
  <div class="box">
    <h2>Economic Calendar <span id="calTimer" class="timer"></span></h2>
    <div id="calendarBox">Loading...</div>
  </div>

</div>



<script>

const BASE = "https://gold-proxy.abhi-koiri.workers.dev";


// ================= TIMERS =================
let goldSec = 60;
let newsSec = 600;
let calSec  = 21600;


function startTimers(){

  setInterval(()=>{

    goldSec--;
    newsSec--;
    calSec--;

    if(goldSec<=0) goldSec=60;
    if(newsSec<=0) newsSec=600;
    if(calSec<=0)  calSec=21600;

    document.getElementById("goldTimer").innerText =
      "Refresh in " + goldSec + "s";

    document.getElementById("newsTimer").innerText =
      "Refresh in " + newsSec + "s";

    document.getElementById("calTimer").innerText =
      "Refresh in " + calSec + "s";

  },1000);
}



// ================= GOLD =================
async function loadGold(){

  try{

    const r = await fetch(`${BASE}/gold`);
    const d = await r.json();

    const price =
      d.chart.result[0].meta.regularMarketPrice;

    document.getElementById("goldPrice").innerHTML =
      `<b>$${price}</b>`;

  }catch{

    document.getElementById("goldPrice").innerText =
      "Gold unavailable";
  }
}



// ================= NEWS =================
async function loadNews(){

  try{

    const r = await fetch(`${BASE}/news?q=gold economy inflation fed rates`);
    const d = await r.json();

    const box = document.getElementById("newsBox");

    box.innerHTML="";

    d.articles.slice(0,6).forEach(n=>{

      box.innerHTML+=`
        <div>
          <b>${n.title}</b><br>
          <small>${n.source.name}</small>
        </div>
        <hr>
      `;
    });

  }catch{

    document.getElementById("newsBox").innerText =
      "News unavailable";
  }
}



// ================= CALENDAR =================
async function loadCalendar(){

  try{

    const r = await fetch(`${BASE}/calendar`);
    const d = await r.json();

    const box = document.getElementById("calendarBox");

    box.innerHTML="";

    d.slice(0,6).forEach(ev=>{

      box.innerHTML+=`
        <div>
          <b>${ev.country}</b> - ${ev.event}<br>
          Impact: ${ev.impact}
        </div>
        <hr>
      `;
    });

  }catch{

    document.getElementById("calendarBox").innerText =
      "Calendar unavailable";
  }
}



// ================= LOAD ALL =================
function loadAll(){

  loadGold();
  loadNews();
  loadCalendar();
}



// ================= START =================
loadAll();
startTimers();


// Gold every 1 min
setInterval(loadGold,60000);

// News every 10 min
setInterval(loadNews,600000);

// Calendar every 6 hours
setInterval(loadCalendar,21600000);


</script>


</body>
</html>
