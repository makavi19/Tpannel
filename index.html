<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gold Trading Dashboard</title>

<style>

body{
  margin:0;
  padding:20px;
  background:#fff;
  color:#000;
  font-family:Arial;
}

h1{
  text-align:center;
  margin-bottom:20px;
}

/* GRID */

.dashboard{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
}

/* BOX */

.box{
  border:1px solid #000;
  padding:15px;
  min-height:180px;
  border-radius:6px;
  background:white;
}

.box h3{
  margin-top:0;
  border-bottom:1px solid #000;
  padding-bottom:6px;
}

/* HIGHLIGHT */

.gold-impact{
  border:3px solid gold;
  background:#fffbe6;
}

/* TIMER */

.timer{
  float:right;
  font-size:12px;
  color:#555;
}

ul{
  padding-left:18px;
}

li{
  font-size:14px;
  margin-bottom:6px;
}

</style>
</head>

<body>

<h1>Gold Trading Live Dashboard</h1>

<div class="dashboard">

<!-- 1 ECONOMIC NEWS -->
<div class="box">
<h3>Economic News</h3>
<ul id="ecoNews">Loading...</ul>
</div>

<!-- 2 CENTRAL BANK -->
<div class="box">
<h3>Central Banks</h3>
<ul id="cbNews">Loading...</ul>
</div>

<!-- 3 USD -->
<div class="box">
<h3>US Dollar</h3>
<ul id="usdNews">Loading...</ul>
</div>

<!-- 4 GEOPOLITICS -->
<div class="box">
<h3>Geopolitics</h3>
<ul id="geoNews">Loading...</ul>
</div>

<!-- 5 SENTIMENT -->
<div class="box">
<h3>Market Sentiment</h3>
<p id="sentiment">Neutral</p>
</div>

<!-- 6 COMMODITIES -->
<div class="box">
<h3>Commodities</h3>
<p>Gold â€¢ Silver â€¢ Oil</p>
</div>

<!-- 7 GOLD PRICE -->
<div class="box">
<h3>Gold Price <span id="goldTimer" class="timer"></span></h3>
<h2 id="goldPrice">Loading...</h2>
</div>

<!-- 8 CALENDAR -->
<div class="box">
<h3>Economic Calendar</h3>
<ul id="calendarBox">Loading...</ul>
</div>

<!-- 9 GOLD IMPACT (SPECIAL) -->
<div class="box gold-impact">
<h3>ðŸ”¥ Gold Impact News</h3>
<ul id="goldImpact">Loading...</ul>
</div>

</div>


<script>

const BASE = "https://gold-proxy.abhi-koiri.workers.dev";

let goldTime=60;


/* ================= GOLD ================= */

async function loadGold(){

 try{

  const r = await fetch(BASE+"/gold");
  const d = await r.json();

  const p = d.chart.result[0].meta.regularMarketPrice;

  document.getElementById("goldPrice").innerText="$ "+p;

 }catch{

  document.getElementById("goldPrice").innerText="Unavailable";
 }
}

function goldTimer(){

 goldTime--;

 if(goldTime<=0){
  goldTime=60;
  loadGold();
 }

 document.getElementById("goldTimer").innerText=
 "Refresh "+goldTime+"s";
}

setInterval(goldTimer,1000);
loadGold();


/* ================= NEWS ================= */

async function loadNews(){

 try{

  const r = await fetch(BASE+"/news?q=gold");
  const d = await r.json();

  let eco="",cb="",usd="",geo="",impact="";

  const keywords=[
   "fed","rate","inflation","cpi","war",
   "recession","dollar","central bank"
  ];

  d.articles.slice(0,15).forEach(n=>{

   const t = n.title.toLowerCase();

   let li=`<li>
   <a href="${n.url}" target="_blank">${n.title}</a>
   </li>`;

   if(t.includes("economy")||t.includes("growth"))
    eco+=li;

   if(t.includes("fed")||t.includes("central"))
    cb+=li;

   if(t.includes("dollar")||t.includes("usd"))
    usd+=li;

   if(t.includes("war")||t.includes("china"))
    geo+=li;

   if(keywords.some(k=>t.includes(k)))
    impact+=li;

  });

  document.getElementById("ecoNews").innerHTML=eco||"No data";
  document.getElementById("cbNews").innerHTML=cb||"No data";
  document.getElementById("usdNews").innerHTML=usd||"No data";
  document.getElementById("geoNews").innerHTML=geo||"No data";
  document.getElementById("goldImpact").innerHTML=impact||"No alerts";

 }catch{

  document.querySelectorAll("ul")
  .forEach(u=>u.innerText="Unavailable");
 }
}

loadNews();
setInterval(loadNews,300000); // 5 min


/* ================= CALENDAR ================= */

async function loadCalendar(){

 try{

  const r = await fetch(BASE+"/calendar");
  const d = await r.json();

  let html="";

  d.slice(0,5).forEach(e=>{

   html+=`<li>${e.date} - ${e.event}</li>`;
  });

  document.getElementById("calendarBox").innerHTML=html;

 }catch{

  document.getElementById("calendarBox").innerText="Unavailable";
 }
}

loadCalendar();
setInterval(loadCalendar,21600000); // 6h


</script>

</body>
</html>
